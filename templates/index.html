<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå¹³å°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6366f1;
            --primary-hover: #4f46e5;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --light-bg: #f8fafc;
            --border-color: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
        }

        * {
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .main-container {
            background: white;
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            margin: 2rem auto;
            max-width: 1000px;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.125rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        /* é¡¶éƒ¨å¯¼èˆªèœå•æ ·å¼ */
        .top-nav-menu {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem 1.5rem;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            position: relative;
        }

        .nav-item:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -5px rgba(99, 102, 241, 0.2);
        }

        .nav-item i {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .nav-item span {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
            text-align: center;
            line-height: 1.2;
        }

        .nav-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--success-color);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            border: 2px solid white;
        }

        @media (max-width: 768px) {
            .top-nav-menu {
                gap: 0.5rem;
            }
            
            .nav-item {
                min-width: 100px;
                padding: 0.75rem 1rem;
            }
            
            .nav-item i {
                font-size: 1.25rem;
            }
            
            .nav-item span {
                font-size: 0.75rem;
            }
        }
        
        .content-section {
            padding: 3rem 2rem;
        }

        .form-card {
            background: white;
            border-radius: 16px;
            border: 1px solid var(--border-color);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .form-card:hover {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-label {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-control, .form-select {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            outline: none;
        }

        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            border: none;
            border-radius: 12px;
            padding: 1rem 2rem;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            transform: none;
        }

        .btn-secondary {
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 500;
            border: 1px solid var(--border-color);
            background: white;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: var(--light-bg);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .info-card {
            background: var(--light-bg);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid var(--border-color);
        }

        .prerequisite-card {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-radius: 16px;
            padding: 2rem;
            border: 2px solid #ffc107;
            position: relative;
            overflow: hidden;
        }

        .prerequisite-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="warning-pattern" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="%23ffc107" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23warning-pattern)"/></svg>');
            opacity: 0.3;
        }

        .prerequisite-card .card-title {
            position: relative;
            z-index: 1;
            color: #856404;
        }

        .prerequisite-content {
            position: relative;
            z-index: 1;
        }

        .prerequisite-desc {
            color: #856404;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .setup-steps {
            margin: 1.5rem 0;
        }

        .setup-step {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            border: 1px solid rgba(255, 193, 7, 0.3);
            transition: all 0.3s ease;
        }

        .setup-step:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.2);
        }

        .step-number {
            background: linear-gradient(135deg, #ffc107 0%, #ff8f00 100%);
            color: white;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            color: #856404;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .step-desc {
            color: #856404;
            font-size: 0.85rem;
            margin-bottom: 0.75rem;
            line-height: 1.4;
        }

        .step-image {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .step-image:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }

        .step-image {
            position: relative;
            cursor: pointer;
            overflow: hidden;
        }

        .step-image img {
            width: 100%;
            height: auto;
            display: block;
            transition: all 0.3s ease;
        }

        .clickable-image {
            cursor: pointer;
        }

        .clickable-image:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .image-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.5rem;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .step-image:hover .image-overlay {
            opacity: 1;
        }

        .image-overlay i {
            font-size: 1.2rem;
        }

        .prerequisite-note {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 1rem;
            border-left: 4px solid #28a745;
            color: #155724;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        /* å›¾ç‰‡æ¨¡æ€å¼¹çª—æ ·å¼ */
        .modal-xl {
            max-width: 90%;
        }

        #imageModal .modal-body {
            padding: 0;
            background: #000;
        }

        #imageModal .modal-content {
            background: #000;
            border: none;
            border-radius: 12px;
        }

        #imageModal .modal-header {
            background: #000;
            color: white;
            border-bottom: 1px solid #333;
        }

        #imageModal .modal-footer {
            background: #000;
            border-top: 1px solid #333;
        }

        #imageModal .btn-close {
            filter: invert(1);
        }

        #modalImage {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .feature-item {
            text-align: center;
            padding: 1.5rem;
            background: white;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .feature-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .feature-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .feature-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .feature-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .tips-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            border-left: 4px solid var(--primary-color);
        }

        .tips-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tips-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .tips-list li {
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .tips-list li::before {
            content: 'âœ“';
            color: var(--success-color);
            font-weight: bold;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 3rem 2rem;
            background: white;
        }

        .spinner-border {
            width: 3rem;
            height: 3rem;
            color: var(--primary-color);
        }

        .alert {
            border-radius: 12px;
            border: none;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
        }

        .result-section {
            background: var(--light-bg);
            padding: 2rem;
            border-top: 1px solid var(--border-color);
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            color: var(--success-color);
            font-weight: 600;
            font-size: 1.25rem;
        }

        .nav-tabs {
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 1.5rem;
        }

        .nav-tabs .nav-link {
            border: none;
            border-radius: 8px 8px 0 0;
            margin-right: 0.5rem;
            font-weight: 500;
            color: var(--text-secondary);
            padding: 0.75rem 1.5rem;
            transition: all 0.3s ease;
        }

        .nav-tabs .nav-link.active {
            background: var(--primary-color);
            color: white;
        }

        .nav-tabs .nav-link:hover:not(.active) {
            background: var(--light-bg);
            color: var(--text-primary);
        }

        .tab-content {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .preview-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .preview-title {
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .preview-content {
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            color: var(--text-primary);
        }

        .preview-content::-webkit-scrollbar {
            width: 8px;
        }

        .preview-content::-webkit-scrollbar-track {
            background: var(--light-bg);
            border-radius: 4px;
        }

        .preview-content::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        .preview-content::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
        }

        .btn-group .btn {
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 500;
            border: 1px solid var(--border-color);
            background: white;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .btn-group .btn:hover {
            background: var(--light-bg);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .btn-group .btn:active {
            transform: translateY(1px);
        }

        .copy-success {
            background: var(--success-color) !important;
            color: white !important;
            border-color: var(--success-color) !important;
        }

        .copy-success:hover {
            background: var(--success-color) !important;
            color: white !important;
        }

        .copy-feedback {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .preview-content {
            user-select: text;
            cursor: text;
        }

        .history-item {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            box-shadow: 0 5px 15px -5px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .history-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .history-title {
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            flex: 1;
        }

        .history-date {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .history-files {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .file-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.875rem;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .file-badge:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            text-decoration: none;
        }

        .file-badge .file-type {
            font-weight: 500;
        }

        .file-badge .file-size {
            color: var(--text-secondary);
            font-size: 0.75rem;
        }

        .file-badge:hover .file-size {
            color: rgba(255, 255, 255, 0.8);
        }

        .file-badge-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .file-badge-container:hover {
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .file-badge-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
        }

        .file-badge-actions {
            display: flex;
            gap: 0.25rem;
        }

        .file-badge-actions .btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }

        .empty-history {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-secondary);
        }

        .empty-history i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .history-stats {
            padding: 1rem;
            background: var(--light-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            line-height: 1;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .btn-outline-primary {
            border-color: var(--primary-color);
            color: var(--primary-color);
            background: transparent;
        }

        .btn-outline-primary:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .btn-outline-secondary {
            border-color: var(--secondary-color);
            color: var(--secondary-color);
            background: transparent;
        }

        .btn-outline-secondary:hover {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .history-manager-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1050;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .history-manager-content {
            background: white;
            border-radius: 16px;
            max-width: 90%;
            max-height: 90%;
            width: 800px;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .history-manager-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .history-manager-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
        }

        .history-manager-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }

        .history-manager-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .history-manager-body {
            padding: 2rem;
            max-height: 60vh;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .main-container {
                margin: 1rem;
                border-radius: 16px;
            }

            .header {
                padding: 2rem 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .content-section {
                padding: 2rem 1rem;
            }

            .feature-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .form-card, .info-card, .prerequisite-card {
                padding: 1.5rem;
            }

            .setup-step {
                flex-direction: column;
                gap: 0.75rem;
            }

            .step-number {
                align-self: center;
            }

            .step-image {
                margin-top: 0.5rem;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å¿«é€Ÿå¼€å§‹æ­¥éª¤æ ·å¼ */
        .quick-start-steps {
            margin-bottom: 1.5rem;
        }

        .step-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1rem;
            padding: 1rem;
            background: var(--light-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .step-number {
            background: var(--primary-color);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
        }

        .step-desc {
            color: var(--text-secondary);
            font-size: 0.8rem;
            line-height: 1.4;
        }

        /* å‰ç½®æ¡ä»¶æ¨¡æ€æ¡†æ ·å¼ */
        .prerequisites-content {
            max-width: 100%;
        }

        .prerequisite-desc {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 1rem;
            color: #92400e;
        }

        .setup-steps {
            margin-bottom: 1.5rem;
        }

        .setup-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            background: var(--light-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .setup-step .step-number {
            background: var(--warning-color);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1rem;
            margin-right: 1.5rem;
            flex-shrink: 0;
        }

        .setup-step .step-content {
            flex: 1;
        }

        .setup-step .step-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .setup-step .step-desc {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        .step-image {
            position: relative;
            display: inline-block;
            cursor: pointer;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .step-image img {
            max-width: 300px;
            height: auto;
            display: block;
        }

        .image-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .step-image:hover .image-overlay {
            opacity: 1;
        }

        .image-overlay i {
            color: white;
            font-size: 2rem;
        }

        .prerequisite-note {
            background: #dbeafe;
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 1rem;
            color: #1e40af;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .prerequisite-note i {
            font-size: 1.25rem;
        }

        /* æ¨¡æ¿å¸®åŠ©é¢æ¿æ ·å¼ */
        .template-help-panel {
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            height: 100%;
        }

        .template-help-panel h6 {
            color: var(--primary-color);
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        .template-tips {
            list-style: none;
            padding: 0;
            margin-bottom: 1.5rem;
        }

        .template-tips li {
            padding: 0.25rem 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
            position: relative;
            padding-left: 1rem;
        }

        .template-tips li:before {
            content: "â€¢";
            color: var(--primary-color);
            position: absolute;
            left: 0;
        }

        .template-example {
            border-top: 1px solid var(--border-color);
            padding-top: 1rem;
        }

        .template-example h6 {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .example-content {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 0.75rem;
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .example-content code {
            background: none;
            color: var(--text-primary);
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="main-container">
            <!-- å¤´éƒ¨ -->
            <div class="header">
                <h1><i class="bi bi-cpu"></i> æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå¹³å°</h1>
                <p>åŸºäºAIçš„æ™ºèƒ½æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå·¥å…·</p>
                
                <!-- é¡¶éƒ¨å¯¼èˆªèœå• -->
                <div class="top-nav-menu">
                    <div class="nav-item" onclick="openHistoryManager()">
                        <i class="bi bi-clock-history"></i>
                        <span>å†å²ç”¨ä¾‹ç®¡ç†</span>
                        <small class="nav-count" id="historyCount">-</small>
                    </div>
                    <div class="nav-item" onclick="openPromptManager()">
                        <i class="bi bi-chat-quote"></i>
                        <span>æç¤ºè¯ç®¡ç†</span>
                        <small class="nav-count" id="promptCount">-</small>
                    </div>
                    <div class="nav-item" onclick="showPrerequisites()">
                        <i class="bi bi-exclamation-triangle"></i>
                        <span>ä½¿ç”¨è¯´æ˜</span>
                    </div>
                </div>
            </div>
            
            <!-- ä¸»è¦å†…å®¹ -->
            <div class="content-section">
                <div class="row">
                    <!-- å·¦ä¾§ï¼šé…ç½®è¡¨å•å’Œç»“æœå±•ç¤º -->
                    <div class="col-lg-8">
                        <div class="form-card fade-in">
                            <div class="card-title">
                                <i class="bi bi-gear"></i>
                                é…ç½®é€‰é¡¹
                            </div>
                            
                            <!-- AIæä¾›å•†é€‰æ‹© -->
                            <div class="mb-4">
                                <label for="aiProvider" class="form-label">
                                    <i class="bi bi-robot"></i>
                                    AIæä¾›å•†
                                </label>
                                <select class="form-select" id="aiProvider" onchange="onAIProviderChange()">
                                    <option value="doubao">è±†åŒ… (Doubao) - æ¨èç”¨äºæµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ</option>
                                    <option value="deepseek">DeepSeek - é€šç”¨AIæ¨¡å‹</option>
                                </select>
                            </div>

                            <!-- è±†åŒ…å¯†é’¥é€‰æ‹© -->
                            <div class="mb-4" id="doubaoKeySection">
                                <label for="doubaoKey" class="form-label">
                                    <i class="bi bi-person"></i>
                                    è±†åŒ…è´¦å·é€‰æ‹©
                                </label>
                                <select class="form-select" id="doubaoKey">
                                    <option value="">åŠ è½½ä¸­...</option>
                                </select>
                                <small class="form-text text-muted">é€‰æ‹©è¦ä½¿ç”¨çš„è±†åŒ…è´¦å·</small>
                            </div>

                            <!-- æç¤ºè¯æ¨¡æ¿é€‰æ‹© -->
                            <div class="mb-4">
                                <label for="promptTemplate" class="form-label">
                                    <i class="bi bi-file-text"></i>
                                    æç¤ºè¯æ¨¡æ¿
                                </label>
                                <div class="d-flex gap-2 mb-2">
                                    <select class="form-select" id="promptTemplate" onchange="onPromptTemplateChange()">
                                        <option value="">åŠ è½½ä¸­...</option>
                                    </select>
                                    <button type="button" class="btn btn-outline-info" onclick="previewPromptTemplate()" title="é¢„è§ˆæ¨¡æ¿å†…å®¹">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                    <button type="button" class="btn btn-outline-primary" onclick="showCreateTemplateModal()">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                </div>
                                <small class="form-text text-muted">é€‰æ‹©è¦ä½¿ç”¨çš„æç¤ºè¯æ¨¡æ¿ï¼Œç‚¹å‡»ğŸ‘ï¸é¢„è§ˆå†…å®¹ï¼Œæˆ–ç‚¹å‡»+å·åˆ›å»ºè‡ªå®šä¹‰æ¨¡æ¿</small>
                                
                                <!-- è‡ªå®šä¹‰è¦æ±‚åŒºåŸŸ -->
                                <div id="customRequirementsSection" class="mt-3" style="display: none;">
                                    <label for="userRequirements" class="form-label">
                                        <i class="bi bi-pencil"></i>
                                        è‡ªå®šä¹‰è¦æ±‚ <span class="text-muted">(å¯é€‰)</span>
                                    </label>
                                    <textarea class="form-control" id="userRequirements" rows="3" 
                                              placeholder="è¯·è¾“å…¥æ‚¨çš„è‡ªå®šä¹‰è¦æ±‚ï¼Œä¾‹å¦‚ï¼šé‡ç‚¹å…³æ³¨è¾¹ç•Œæ¡ä»¶æµ‹è¯•ã€å¼‚å¸¸æµç¨‹æµ‹è¯•ç­‰"></textarea>
                                    <small class="form-text text-muted">ä¸ºé€‰ä¸­çš„æç¤ºè¯æ¨¡æ¿æ·»åŠ ç‰¹å®šè¦æ±‚ï¼Œè¿™äº›è¦æ±‚ä¼šä¸æ¨¡æ¿å†…å®¹ç»“åˆï¼Œç”Ÿæˆæ›´ç¬¦åˆæ‚¨éœ€æ±‚çš„æµ‹è¯•ç”¨ä¾‹</small>
                                </div>
                            </div>

                            <!-- æ¨¡å‹é€‰æ‹© -->
                            <div class="mb-4" id="modelSection" style="display: none;">
                                <label for="aiModel" class="form-label">
                                    <i class="bi bi-cpu"></i>
                                    æ¨¡å‹é€‰æ‹©
                                </label>
                                <select class="form-select" id="aiModel">
                                    <!-- åŠ¨æ€åŠ è½½æ¨¡å‹é€‰é¡¹ -->
                                </select>
                            </div>

                            <!-- æ¨¡å‹å‚æ•°é…ç½® -->
                            <div class="mb-4" id="modelParamsSection" style="display: none;">
                                <label class="form-label">
                                    <i class="bi bi-sliders"></i>
                                    æ¨¡å‹å‚æ•°
                                </label>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="temperature" class="form-label">Temperature (æ¸©åº¦)</label>
                                        <input type="range" class="form-range" id="temperature" min="0" max="2" step="0.1" value="0.3">
                                        <div class="d-flex justify-content-between">
                                            <small>0.0 (ç¡®å®šæ€§)</small>
                                            <small id="temperatureValue">0.3</small>
                                            <small>2.0 (åˆ›é€ æ€§)</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="topP" class="form-label">Top-p (æ ¸é‡‡æ ·)</label>
                                        <input type="range" class="form-range" id="topP" min="0" max="1" step="0.1" value="0.6">
                                        <div class="d-flex justify-content-between">
                                            <small>0.0</small>
                                            <small id="topPValue">0.6</small>
                                            <small>1.0</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- è¾“å…¥æ–¹å¼é€‰æ‹© -->
                            <div class="mb-4">
                                <label class="form-label">
                                    <i class="bi bi-input-cursor"></i>
                                    è¾“å…¥æ–¹å¼
                                </label>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="inputType" id="urlInput" value="url" checked>
                                            <label class="form-check-label" for="urlInput">
                                                é£ä¹¦æ–‡æ¡£URL
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="inputType" id="contentInput" value="content">
                                            <label class="form-check-label" for="contentInput">
                                                ç›´æ¥è¾“å…¥å†…å®¹
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- URLè¾“å…¥ -->
                            <div id="urlSection" class="mb-4">
                                <label for="documentUrl" class="form-label">
                                    <i class="bi bi-link-45deg"></i>
                                    é£ä¹¦æ–‡æ¡£URL
                                </label>
                                <input type="url" class="form-control" id="documentUrl" 
                                       placeholder="è¯·è¾“å…¥é£ä¹¦æ–‡æ¡£é“¾æ¥ï¼Œä¾‹å¦‚ï¼šhttps://xxx.feishu.cn/docx/xxx æˆ– https://xxx.feishu.cn/wiki/xxx">
                            </div>
                            
                            <!-- å†…å®¹è¾“å…¥ -->
                            <div id="contentSection" class="mb-4" style="display: none;">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="documentTitle" class="form-label">
                                            <i class="bi bi-type"></i>
                                            æ–‡æ¡£æ ‡é¢˜
                                        </label>
                                        <input type="text" class="form-control" id="documentTitle" 
                                               placeholder="è¯·è¾“å…¥æ–‡æ¡£æ ‡é¢˜" value="æµ‹è¯•ç”¨ä¾‹">
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <label for="documentContent" class="form-label">
                                        <i class="bi bi-file-text"></i>
                                        æ–‡æ¡£å†…å®¹
                                    </label>
                                    <textarea class="form-control" id="documentContent" rows="6" 
                                              placeholder="è¯·è¾“å…¥æ–‡æ¡£å†…å®¹..."></textarea>
                                </div>
                            </div>
                            
                            <!-- ç”ŸæˆæŒ‰é’® -->
                            <button type="button" class="btn btn-primary" id="generateBtn" onclick="generateTestCases()">
                                <i class="bi bi-play-circle"></i>
                                ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
                            </button>
                        </div>
                        
                        <!-- åŠ è½½çŠ¶æ€ -->
                        <div class="loading" id="loadingSection" style="display: none;">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">ç”Ÿæˆä¸­...</span>
                            </div>
                            <p class="mt-3">æ­£åœ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼Œè¯·ç¨å€™...</p>
                        </div>
                        
                        <!-- ç»“æœå±•ç¤º -->
                        <div class="result-section" id="resultSection" style="display: none;">
                            <div class="result-header">
                                <i class="bi bi-check-circle"></i>
                                ç”Ÿæˆå®Œæˆï¼
                            </div>
                            
                            <!-- ç»“æœæ ‡ç­¾é¡µ -->
                            <ul class="nav nav-tabs" id="resultTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="mindnote-tab" data-bs-toggle="tab" 
                                            data-bs-target="#mindnote" type="button" role="tab">
                                        <i class="bi bi-list-check"></i>
                                        æ€ç»´ç¬”è®°æ ¼å¼
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="raw-tab" data-bs-toggle="tab" 
                                            data-bs-target="#raw" type="button" role="tab">
                                        <i class="bi bi-file-text"></i>
                                        åŸå§‹æ ¼å¼
                                    </button>
                                </li>
                            </ul>
                            
                            <div class="tab-content" id="resultTabContent">
                                <div class="tab-pane fade show active" id="mindnote" role="tabpanel">
                                    <div class="preview-header">
                                        <h6 class="preview-title">ä¼˜åŒ–åçš„æ€ç»´ç¬”è®°æ ¼å¼ï¼ˆæ¨èï¼‰</h6>
                                        <div class="btn-group" role="group">
                                            <button class="btn btn-secondary" onclick="copyToClipboard('mindnote', this)" title="å¤åˆ¶åˆ°å‰ªè´´æ¿">
                                                <i class="bi bi-clipboard"></i>
                                                å¤åˆ¶
                                            </button>
                                            <button class="btn btn-secondary" onclick="downloadFile('mindnote')" title="ä¸‹è½½æ–‡ä»¶">
                                                <i class="bi bi-download"></i>
                                                ä¸‹è½½
                                            </button>
                                        </div>
                                    </div>
                                    <div class="preview-content" id="mindnoteContent"></div>
                                </div>
                                
                                <div class="tab-pane fade" id="raw" role="tabpanel">
                                    <div class="preview-header">
                                        <h6 class="preview-title">åŸå§‹AIç”Ÿæˆå†…å®¹</h6>
                                        <div class="btn-group" role="group">
                                            <button class="btn btn-secondary" onclick="copyToClipboard('raw', this)" title="å¤åˆ¶åˆ°å‰ªè´´æ¿">
                                                <i class="bi bi-clipboard"></i>
                                                å¤åˆ¶
                                            </button>
                                            <button class="btn btn-secondary" onclick="downloadFile('raw')" title="ä¸‹è½½æ–‡ä»¶">
                                                <i class="bi bi-download"></i>
                                                ä¸‹è½½
                                            </button>
                                        </div>
                                    </div>
                                    <div class="preview-content" id="rawContent"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å³ä¾§ï¼šä½¿ç”¨è¯´æ˜ -->
                    <div class="col-lg-4">
                        <!-- ä½¿ç”¨è¯´æ˜ -->
                        <div class="info-card fade-in">
                            <div class="card-title">
                                <i class="bi bi-info-circle"></i>
                                å¿«é€Ÿå¼€å§‹
                            </div>
                            
                            <div class="quick-start-steps">
                                <div class="step-item">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <div class="step-title">é€‰æ‹©AIæä¾›å•†</div>
                                        <div class="step-desc">æ¨èä½¿ç”¨è±†åŒ…AIï¼Œæ”¯æŒå¤šæ¨¡æ€è¾“å…¥</div>
                                    </div>
                                </div>
                                
                                <div class="step-item">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <div class="step-title">è¾“å…¥æ–‡æ¡£å†…å®¹</div>
                                        <div class="step-desc">æä¾›é£ä¹¦æ–‡æ¡£URLæˆ–ç›´æ¥è¾“å…¥å†…å®¹</div>
                                    </div>
                                </div>
                                
                                <div class="step-item">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <div class="step-title">ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹</div>
                                        <div class="step-desc">ç‚¹å‡»ç”ŸæˆæŒ‰é’®ï¼Œè·å–AIç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="tips-section">
                                <div class="tips-title">
                                    <i class="bi bi-lightbulb"></i>
                                    ä½¿ç”¨æç¤º
                                </div>
                                <ul class="tips-list">
                                    <li>æ”¯æŒé£ä¹¦æ–‡æ¡£å’ŒWikié“¾æ¥ç›´æ¥è§£æ</li>
                                    <li>è‡ªåŠ¨ç”Ÿæˆæ€ç»´ç¬”è®°æ ¼å¼æ–‡ä»¶</li>
                                    <li>å¯ä¸‹è½½åŸå§‹å’Œä¼˜åŒ–åçš„æµ‹è¯•ç”¨ä¾‹</li>
                                    <li>æ”¯æŒä¸€é”®å¤åˆ¶ï¼Œæ ¼å¼ä¸ä¸‹è½½æ–‡ä»¶å®Œå…¨ä¸€è‡´</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å†å²ç®¡ç†æ¨¡æ€æ¡† -->
    <div class="history-manager-modal" id="historyManagerModal">
        <div class="history-manager-content">
            <div class="history-manager-header">
                <h5 class="history-manager-title">
                    <i class="bi bi-clock-history"></i>
                    å†å²ç”¨ä¾‹ç®¡ç†
                </h5>
                <button class="history-manager-close" onclick="closeHistoryManager()">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="history-manager-body">
                <div id="historyManagerContent">
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">åŠ è½½ä¸­...</span>
                        </div>
                        <p class="mt-3">æ­£åœ¨åŠ è½½å†å²è®°å½•...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æç¤ºè¯ç®¡ç†æ¨¡æ€æ¡† -->
    <div class="history-manager-modal" id="promptManagerModal">
        <div class="history-manager-content">
            <div class="history-manager-header">
                <h5 class="history-manager-title">
                    <i class="bi bi-chat-quote"></i>
                    æç¤ºè¯ç®¡ç†
                </h5>
                <button class="history-manager-close" onclick="closePromptManager()">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="history-manager-body">
                <div id="promptManagerContent">
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">åŠ è½½ä¸­...</span>
                        </div>
                        <p class="mt-3">æ­£åœ¨åŠ è½½æç¤ºè¯...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å‰ç½®æ¡ä»¶æ¨¡æ€æ¡† -->
    <div class="history-manager-modal" id="prerequisitesModal">
        <div class="history-manager-content">
            <div class="history-manager-header">
                <h5 class="history-manager-title">
                    <i class="bi bi-exclamation-triangle"></i>
                    å‰ç½®æ¡ä»¶è®¾ç½®
                </h5>
                <button class="history-manager-close" onclick="closePrerequisites()">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="history-manager-body">
                <div class="prerequisites-content">
                    <div class="prerequisite-desc mb-4">
                        <strong>é‡è¦æé†’ï¼š</strong>ä½¿ç”¨å¹³å°å‰ï¼Œè¯·å…ˆåœ¨é£ä¹¦äº‘æ–‡æ¡£ä¸­å®Œæˆä»¥ä¸‹è®¾ç½®ï¼š
                    </div>
                    
                    <div class="setup-steps">
                        <div class="setup-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <div class="step-title">æ‰“å¼€é£ä¹¦äº‘æ–‡æ¡£</div>
                                <div class="step-desc">åœ¨é£ä¹¦äº‘æ–‡æ¡£ä¸­æ‰“å¼€è¦åˆ†æçš„æ–‡æ¡£</div>
                                <div class="step-image">
                                    <img src="/static/images/feishu_setup_step1.jpeg" alt="é£ä¹¦äº‘æ–‡æ¡£ç•Œé¢" class="img-fluid rounded clickable-image" 
                                         onclick="openImageModal('/static/images/feishu_setup_step1.jpeg', 'é£ä¹¦äº‘æ–‡æ¡£ç•Œé¢')" 
                                         title="ç‚¹å‡»æŸ¥çœ‹å¤§å›¾">
                                    <div class="image-overlay">
                                        <i class="bi bi-zoom-in"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="setup-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <div class="step-title">æ·»åŠ æ–‡æ¡£åº”ç”¨</div>
                                <div class="step-desc">ç‚¹å‡»å³ä¸Šè§’"..." â†’ "æ·»åŠ æ–‡æ¡£åº”ç”¨" â†’ é€‰æ‹©"æ–‡æ¡£è¯»å–å™¨"</div>
                                <div class="step-image">
                                    <img src="/static/images/feishu_setup_step2.jpeg" alt="æ·»åŠ æ–‡æ¡£åº”ç”¨" class="img-fluid rounded clickable-image" 
                                         onclick="openImageModal('/static/images/feishu_setup_step2.jpeg', 'æ·»åŠ æ–‡æ¡£åº”ç”¨')" 
                                         title="ç‚¹å‡»æŸ¥çœ‹å¤§å›¾">
                                    <div class="image-overlay">
                                        <i class="bi bi-zoom-in"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="setup-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <div class="step-title">è·å–æ–‡æ¡£é“¾æ¥</div>
                                <div class="step-desc">ç‚¹å‡»"åˆ†äº«" â†’ "å¤åˆ¶é“¾æ¥"ï¼Œå°†é“¾æ¥ç²˜è´´åˆ°å¹³å°ä¸­</div>
                                <div class="step-image">
                                    <img src="/static/images/feishu_setup_step3.jpeg" alt="è·å–æ–‡æ¡£é“¾æ¥" class="img-fluid rounded clickable-image" 
                                         onclick="openImageModal('/static/images/feishu_setup_step3.jpeg', 'è·å–æ–‡æ¡£é“¾æ¥')" 
                                         title="ç‚¹å‡»æŸ¥çœ‹å¤§å›¾">
                                    <div class="image-overlay">
                                        <i class="bi bi-zoom-in"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="prerequisite-note mt-4">
                        <i class="bi bi-lightbulb"></i>
                        å®Œæˆä»¥ä¸Šè®¾ç½®åï¼Œå³å¯ä½¿ç”¨å¹³å°ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // å…¨å±€å˜é‡å­˜å‚¨ç”Ÿæˆçš„æ–‡ä»¶ä¿¡æ¯
        let generatedFiles = {};
        let aiProviders = [];
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('é¡µé¢å¼€å§‹åˆå§‹åŒ–...');
            
            // å¼ºåˆ¶åˆ·æ–°æ‰€æœ‰æ•°æ®ï¼Œé˜²æ­¢ç¼“å­˜é—®é¢˜
            await Promise.all([
                loadAIProviders(),
                loadDoubaoKeys(),
                loadPromptTemplates()
            ]);
            
            // åˆå§‹åŒ–AIæä¾›å•†é€‰æ‹©
            onAIProviderChange();
            
            // è¾“å…¥æ–¹å¼åˆ‡æ¢
            document.querySelectorAll('input[name="inputType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'url') {
                        document.getElementById('urlSection').style.display = 'block';
                        document.getElementById('contentSection').style.display = 'none';
                    } else {
                        document.getElementById('urlSection').style.display = 'none';
                        document.getElementById('contentSection').style.display = 'block';
                    }
                });
            });

            // å‚æ•°æ»‘å—äº‹ä»¶ç›‘å¬
            document.getElementById('temperature').addEventListener('input', function() {
                document.getElementById('temperatureValue').textContent = this.value;
            });

            document.getElementById('topP').addEventListener('input', function() {
                document.getElementById('topPValue').textContent = this.value;
            });
            
            console.log('é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        });
        
        // åŠ è½½AIæä¾›å•†ä¿¡æ¯
        async function loadAIProviders() {
            try {
                // æ·»åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜
                const timestamp = new Date().getTime();
                const response = await fetch(`/api/ai-providers?t=${timestamp}`, {
                    headers: {
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    }
                });
                aiProviders = await response.json();
                console.log('AIæä¾›å•†ä¿¡æ¯åŠ è½½å®Œæˆ:', aiProviders);
            } catch (error) {
                console.error('åŠ è½½AIæä¾›å•†å¤±è´¥:', error);
                // è®¾ç½®é»˜è®¤å€¼ä»¥é˜²åŠ è½½å¤±è´¥
                aiProviders = [
                    {
                        'id': 'doubao',
                        'name': 'è±†åŒ… (Doubao)',
                        'description': 'æ¨èç”¨äºæµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ',
                        'models': [
                            {
                                'id': 'doubao-1-5-thinking-vision-pro-250428',
                                'name': 'Doubao 1.5 Thinking Vision Pro',
                                'description': 'å¤šæ¨¡æ€æ€ç»´æ¨¡å‹ï¼Œæ”¯æŒå›¾åƒå’Œæ–‡æœ¬ç†è§£',
                                'default_temperature': 0.3,
                                'default_top_p': 0.6
                            },
                            {
                                'id': 'doubao-1-5-thinking-pro-250415',
                                'name': 'Doubao 1.5 Thinking Pro',
                                'description': 'æ€ç»´é“¾æ¨ç†æ¨¡å‹ï¼Œé€‚åˆå¤æ‚é€»è¾‘åˆ†æ',
                                'default_temperature': 0.3,
                                'default_top_p': 0.6
                            },
                            {
                                'id': 'doubao-seed-1-6-thinking-250715',
                                'name': 'Doubao Seed 1.6 Thinking',
                                'description': 'ç§å­æ¨¡å‹ï¼Œå¼ºå¤§çš„æ¨ç†å’Œæ€è€ƒèƒ½åŠ›',
                                'default_temperature': 0.3,
                                'default_top_p': 0.6
                            }
                        ]
                    },
                    {
                        'id': 'deepseek',
                        'name': 'DeepSeek',
                        'description': 'é€šç”¨AIæ¨¡å‹',
                        'models': []
                    }
                ];
            }
        }

        // åŠ è½½è±†åŒ…å¯†é’¥åˆ—è¡¨
        async function loadDoubaoKeys() {
            try {
                // æ·»åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜
                const timestamp = new Date().getTime();
                const response = await fetch(`/api/doubao-keys?t=${timestamp}`, {
                    headers: {
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    }
                });
                const result = await response.json();
                
                if (result.success) {
                    const keySelect = document.getElementById('doubaoKey');
                    keySelect.innerHTML = '';
                    
                    console.log('æ”¶åˆ°çš„è±†åŒ…å¯†é’¥æ•°æ®:', result.keys);
                    
                    result.keys.forEach(key => {
                        const option = document.createElement('option');
                        option.value = key.id;
                        option.textContent = key.name;  // åªæ˜¾ç¤ºå§“åï¼Œä¸æ˜¾ç¤ºæ¨¡å‹
                        keySelect.appendChild(option);
                        console.log(`æ·»åŠ å¯†é’¥é€‰é¡¹: ${key.id} = ${key.name}`);
                    });
                    
                    // è®¾ç½®é»˜è®¤é€‰æ‹©
                    if (result.keys.length > 0) {
                        keySelect.value = result.keys[0].id;
                        console.log(`è®¾ç½®é»˜è®¤å¯†é’¥: ${result.keys[0].id}`);
                    }
                    
                    console.log('è±†åŒ…å¯†é’¥åˆ—è¡¨åŠ è½½å®Œæˆ:', result.keys);
                } else {
                    console.error('åŠ è½½è±†åŒ…å¯†é’¥å¤±è´¥:', result.error);
                }
            } catch (error) {
                console.error('åŠ è½½è±†åŒ…å¯†é’¥å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½æç¤ºè¯æ¨¡æ¿åˆ—è¡¨
        async function loadPromptTemplates() {
            try {
                // æ·»åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜
                const timestamp = new Date().getTime();
                const response = await fetch(`/api/prompt-templates?t=${timestamp}`, {
                    headers: {
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    }
                });
                const result = await response.json();
                
                if (result.success) {
                    const templateSelect = document.getElementById('promptTemplate');
                    const currentValue = templateSelect.value;
                    templateSelect.innerHTML = '';
                    
                    // æ·»åŠ é»˜è®¤é€‰é¡¹
                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = 'è¯·é€‰æ‹©æç¤ºè¯æ¨¡æ¿';
                    templateSelect.appendChild(defaultOption);
                    
                    // æ·»åŠ æ–°å¢æ¨¡æ¿é€‰é¡¹
                    const newTemplateOption = document.createElement('option');
                    newTemplateOption.value = 'new_template';
                    newTemplateOption.textContent = 'â• æ–°å¢è‡ªå®šä¹‰æ¨¡æ¿';
                    templateSelect.appendChild(newTemplateOption);
                    
                    console.log('æ”¶åˆ°çš„æç¤ºè¯æ¨¡æ¿æ•°æ®:', result.templates);
                    
                    // æ£€æŸ¥å½“å‰é€‰æ‹©çš„æ¨¡æ¿æ˜¯å¦ä»ç„¶å­˜åœ¨
                    let currentTemplateExists = false;
                    
                    result.templates.forEach(template => {
                        const option = document.createElement('option');
                        option.value = template.id;
                        option.textContent = template.name;
                        option.setAttribute('data-description', template.description);
                        option.setAttribute('data-supports-custom', template.supports_custom_requirements);
                        templateSelect.appendChild(option);
                        
                        // æ£€æŸ¥å½“å‰é€‰æ‹©çš„æ¨¡æ¿æ˜¯å¦ä»ç„¶å­˜åœ¨
                        if (template.id === currentValue) {
                            currentTemplateExists = true;
                        }
                        
                        console.log(`æ·»åŠ æ¨¡æ¿é€‰é¡¹: ${template.id} = ${template.name}`);
                    });
                    
                    // å¦‚æœå½“å‰é€‰æ‹©çš„æ¨¡æ¿ä¸å­˜åœ¨ï¼Œæ¸…é™¤é€‰æ‹©
                    if (currentValue && !currentTemplateExists) {
                        console.log(`å½“å‰é€‰æ‹©çš„æ¨¡æ¿ ${currentValue} å·²ä¸å­˜åœ¨ï¼Œæ¸…é™¤é€‰æ‹©`);
                        templateSelect.value = '';
                        // éšè—è‡ªå®šä¹‰è¦æ±‚åŒºåŸŸ
                        document.getElementById('customRequirementsSection').style.display = 'none';
                    }
                    
                    console.log('æç¤ºè¯æ¨¡æ¿åˆ—è¡¨åŠ è½½å®Œæˆ:', result.templates);
                } else {
                    console.error('åŠ è½½æç¤ºè¯æ¨¡æ¿å¤±è´¥:', result.error);
                    // åŠ è½½å¤±è´¥æ—¶æ¸…é™¤é€‰æ‹©
                    const templateSelect = document.getElementById('promptTemplate');
                    templateSelect.innerHTML = '';
                    templateSelect.value = '';
                    document.getElementById('customRequirementsSection').style.display = 'none';
                }
            } catch (error) {
                console.error('åŠ è½½æç¤ºè¯æ¨¡æ¿å¤±è´¥:', error);
                // åŠ è½½å¤±è´¥æ—¶æ¸…é™¤é€‰æ‹©
                const templateSelect = document.getElementById('promptTemplate');
                templateSelect.innerHTML = '';
                templateSelect.value = '';
                document.getElementById('customRequirementsSection').style.display = 'none';
            }
        }

        // AIæä¾›å•†åˆ‡æ¢å¤„ç†
        function onAIProviderChange() {
            const aiProvider = document.getElementById('aiProvider').value;
            const provider = aiProviders.find(p => p.id === aiProvider);
            
            // æ˜¾ç¤º/éšè—è±†åŒ…å¯†é’¥é€‰æ‹©
            if (aiProvider === 'doubao') {
                document.getElementById('doubaoKeySection').style.display = 'block';
            } else {
                document.getElementById('doubaoKeySection').style.display = 'none';
            }
            
            if (provider && provider.models && provider.models.length > 0) {
                // æ˜¾ç¤ºæ¨¡å‹é€‰æ‹©
                document.getElementById('modelSection').style.display = 'block';
                document.getElementById('modelParamsSection').style.display = 'block';
                
                // åŠ è½½æ¨¡å‹é€‰é¡¹
                const modelSelect = document.getElementById('aiModel');
                modelSelect.innerHTML = '';
                provider.models.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model.id;
                    option.textContent = `${model.name} - ${model.description}`;
                    modelSelect.appendChild(option);
                });
                
                // è®¾ç½®é»˜è®¤å‚æ•°
                if (provider.models.length > 0) {
                    const defaultModel = provider.models[0];
                    document.getElementById('temperature').value = defaultModel.default_temperature || 0.3;
                    document.getElementById('topP').value = defaultModel.default_top_p || 0.6;
                    document.getElementById('temperatureValue').textContent = defaultModel.default_temperature || 0.3;
                    document.getElementById('topPValue').textContent = defaultModel.default_top_p || 0.6;
                }
            } else {
                // éšè—æ¨¡å‹é€‰æ‹©
                document.getElementById('modelSection').style.display = 'none';
                document.getElementById('modelParamsSection').style.display = 'none';
            }
        }

        // ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
        async function generateTestCases() {
            const aiProvider = document.getElementById('aiProvider').value;
            const doubaoKey = document.getElementById('doubaoKey').value;
            const promptTemplate = document.getElementById('promptTemplate').value;
            const userRequirements = document.getElementById('userRequirements').value.trim();
            
            if (!aiProvider) {
                alert('è¯·é€‰æ‹©AIæä¾›å•†');
                return;
            }
            
            if (aiProvider === 'doubao' && !doubaoKey) {
                alert('è¯·é€‰æ‹©è±†åŒ…è´¦å·');
                return;
            }
            
            if (!promptTemplate) {
                alert('è¯·é€‰æ‹©æç¤ºè¯æ¨¡æ¿');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºæ–°å¢æ¨¡æ¿
            if (promptTemplate === 'new_template') {
                alert('è¯·å…ˆåˆ›å»ºè‡ªå®šä¹‰æ¨¡æ¿');
                return;
            }
            
            const inputType = document.querySelector('input[name="inputType"]:checked').value;
            let documentUrl = '';
            let documentTitle = '';
            let documentContent = '';
            
            if (inputType === 'url') {
                documentUrl = document.getElementById('documentUrl').value.trim();
                if (!documentUrl) {
                    alert('è¯·è¾“å…¥é£ä¹¦æ–‡æ¡£URL');
                    return;
                }
            } else {
                documentTitle = document.getElementById('documentTitle').value.trim();
                documentContent = document.getElementById('documentContent').value.trim();
                if (!documentTitle || !documentContent) {
                    alert('è¯·è¾“å…¥æ–‡æ¡£æ ‡é¢˜å’Œå†…å®¹');
                    return;
                }
            }
            
            // è·å–æ¨¡å‹å‚æ•°
            const aiModel = document.getElementById('aiModel').value;
            const temperature = document.getElementById('temperature').value;
            const topP = document.getElementById('topP').value;
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('resultSection').style.display = 'none';
            
            try {
                const requestData = {
                    ai_provider: aiProvider,
                    doubao_key: doubaoKey,
                    prompt_template_id: promptTemplate, // ä¿®å¤å­—æ®µå
                    user_requirements: userRequirements, // ä¼ é€’è‡ªå®šä¹‰è¦æ±‚
                    input_type: inputType,
                    document_url: documentUrl,
                    document_title: documentTitle,
                    document_content: documentContent,
                    model: aiModel,
                    temperature: parseFloat(temperature),
                    top_p: parseFloat(topP)
                };
                
                console.log('å‘é€è¯·æ±‚æ•°æ®:', requestData);
                
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // éšè—åŠ è½½çŠ¶æ€
                    document.getElementById('loadingSection').style.display = 'none';
                    
                    // æ˜¾ç¤ºç»“æœ
                    document.getElementById('resultSection').style.display = 'block';
                    
                    // å¡«å……å†…å®¹
                    if (result.mindnote_content) {
                        document.getElementById('mindnoteContent').textContent = result.mindnote_content;
                    }
                    if (result.raw_content) {
                        document.getElementById('rawContent').textContent = result.raw_content;
                    }
                    
                    // å­˜å‚¨ç”Ÿæˆçš„æ–‡ä»¶ä¿¡æ¯ï¼Œç”¨äºå¤åˆ¶å’Œä¸‹è½½åŠŸèƒ½
                    generatedFiles = {
                        'raw': result.raw_file || '',
                        'mindnote': result.mindnote_file || result.raw_file || ''
                    };
                    
                    console.log('ç”Ÿæˆçš„æ–‡ä»¶ä¿¡æ¯:', generatedFiles);
                    
                    // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
                    document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
                    
                    console.log('æµ‹è¯•ç”¨ä¾‹ç”ŸæˆæˆåŠŸ:', result);
                } else {
                    throw new Error(result.error || 'ç”Ÿæˆå¤±è´¥');
                }
            } catch (error) {
                console.error('ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹å¤±è´¥:', error);
                alert('ç”Ÿæˆå¤±è´¥ï¼š' + error.message);
                
                // éšè—åŠ è½½çŠ¶æ€
                document.getElementById('loadingSection').style.display = 'none';
            }
        }
        
        // ä¸‹è½½æ–‡ä»¶
        function downloadFile(fileType) {
            if (!generatedFiles[fileType]) {
                showAlert('æ–‡ä»¶ä¿¡æ¯ä¸å­˜åœ¨', 'warning');
                return;
            }
            
            const filename = generatedFiles[fileType].split('/').pop();
            const url = `/api/download/${fileType}/${filename}`;
            
            // åˆ›å»ºä¸´æ—¶é“¾æ¥ä¸‹è½½
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // å¤åˆ¶å†…å®¹åˆ°å‰ªè´´æ¿
        async function copyToClipboard(fileType, buttonElement) {
            if (!generatedFiles[fileType]) {
                showAlert('æ–‡ä»¶å†…å®¹ä¸å­˜åœ¨', 'warning');
                return;
            }

            const button = buttonElement || event?.target?.closest('button');
            if (!button) {
                showAlert('æ— æ³•è·å–æŒ‰é’®å…ƒç´ ', 'error');
                return;
            }
            const originalText = button.innerHTML;
            const originalClass = button.className;

            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                button.innerHTML = '<i class="bi bi-hourglass-split"></i> å¤åˆ¶ä¸­...';
                button.disabled = true;

                // ä»æœåŠ¡å™¨è·å–å‡†ç¡®çš„æ–‡ä»¶å†…å®¹
                const filename = generatedFiles[fileType].split('/').pop();
                const response = await fetch(`/api/content/${fileType}/${filename}`);
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'è·å–å†…å®¹å¤±è´¥');
                }

                const content = result.content;
                
                // ä½¿ç”¨ç°ä»£Clipboard API
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(content);
                } else {
                    // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
                    const textArea = document.createElement('textarea');
                    textArea.value = content;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                }
                
                // æ˜¾ç¤ºæˆåŠŸåé¦ˆ
                showCopyFeedback('âœ… å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼å¯ç›´æ¥ç²˜è´´åˆ°æ€ç»´ç¬”è®°');
                
                // æŒ‰é’®çŠ¶æ€åé¦ˆ
                button.innerHTML = '<i class="bi bi-check"></i> å·²å¤åˆ¶';
                button.className = originalClass + ' copy-success';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.className = originalClass;
                    button.disabled = false;
                }, 2000);
                
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                button.innerHTML = originalText;
                button.className = originalClass;
                button.disabled = false;
                
                // é™çº§åˆ°æ‰‹åŠ¨å¤åˆ¶
                showAlert('è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œå·²é€‰ä¸­å†…å®¹ä¾›æ‰‹åŠ¨å¤åˆ¶', 'warning');
                
                // é€‰ä¸­å†…å®¹ä¾›ç”¨æˆ·æ‰‹åŠ¨å¤åˆ¶
                const contentElement = document.getElementById(`${fileType}Content`);
                const range = document.createRange();
                range.selectNodeContents(contentElement);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                
                showAlert('å†…å®¹å·²é€‰ä¸­ï¼Œè¯·æŒ‰ Ctrl+C æ‰‹åŠ¨å¤åˆ¶', 'info');
            }
        }

        // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸåé¦ˆ
        function showCopyFeedback(message) {
            // ç§»é™¤ç°æœ‰åé¦ˆ
            const existingFeedback = document.querySelector('.copy-feedback');
            if (existingFeedback) {
                existingFeedback.remove();
            }
            
            // åˆ›å»ºæ–°åé¦ˆ
            const feedback = document.createElement('div');
            feedback.className = 'copy-feedback';
            feedback.innerHTML = `
                <i class="bi bi-check-circle"></i>
                ${message}
            `;
            
            document.body.appendChild(feedback);
            
            // è‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (feedback.parentNode) {
                    feedback.remove();
                }
            }, 3000);
        }
        
        // æ˜¾ç¤º/éšè—åŠ è½½çŠ¶æ€
        function showLoading(show) {
            const loadingSection = document.getElementById('loadingSection');
            const generateBtn = document.getElementById('generateBtn');
            
            if (show) {
                loadingSection.style.display = 'block';
                generateBtn.disabled = true;
                generateBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> ç”Ÿæˆä¸­...';
            } else {
                loadingSection.style.display = 'none';
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="bi bi-play-circle"></i> ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹';
            }
        }
        
        // æ˜¾ç¤º/éšè—ç»“æœ
        function showResult() {
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        function hideResult() {
            document.getElementById('resultSection').style.display = 'none';
        }
        
        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showAlert(message, type) {
            // ç§»é™¤ç°æœ‰æç¤º
            const existingAlert = document.querySelector('.alert');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            // åˆ›å»ºæ–°æç¤º
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            // æ’å…¥åˆ°è¡¨å•éƒ¨åˆ†å‰é¢
            const formCard = document.querySelector('.form-card');
            formCard.parentNode.insertBefore(alertDiv, formCard);
            
            // è‡ªåŠ¨éšè—
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // æ·»åŠ ä¸€äº›äº¤äº’æ•ˆæœ
            const cards = document.querySelectorAll('.form-card, .info-card, .prerequisite-card');
            cards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-4px)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });
        });

        // åŠ è½½å†å²è®°å½•
        async function loadHistory() {
            const historyContent = document.getElementById('historyContent');
            
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                historyContent.innerHTML = `
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">åŠ è½½ä¸­...</span>
                        </div>
                        <p class="mt-3">æ­£åœ¨åŠ è½½å†å²è®°å½•...</p>
                    </div>
                `;

                const response = await fetch('/api/history');
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'åŠ è½½å¤±è´¥');
                }

                if (result.history.length === 0) {
                    historyContent.innerHTML = `
                        <div class="empty-history">
                            <i class="bi bi-clock-history"></i>
                            <h5>æš‚æ— å†å²è®°å½•</h5>
                            <p>ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹åï¼Œå†å²è®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                        </div>
                    `;
                    return;
                }

                // æ¸²æŸ“å†å²è®°å½•
                const historyHTML = result.history.map(item => {
                    const filesHTML = item.files.map(file => {
                        const fileTypeText = {
                            'raw': 'åŸå§‹æ ¼å¼',
                            'mindnote': 'æ€ç»´ç¬”è®°',
                            'final': 'æœ€ç»ˆæ ¼å¼'
                        }[file.file_type] || 'æœªçŸ¥æ ¼å¼';
                        
                        const fileSize = formatFileSize(file.size);
                        
                        return `
                            <a href="#" class="file-badge" onclick="viewHistoryFile('${file.filename}', '${file.file_type}')">
                                <i class="bi bi-file-text"></i>
                                <span class="file-type">${fileTypeText}</span>
                                <span class="file-size">${fileSize}</span>
                            </a>
                        `;
                    }).join('');

                    return `
                        <div class="history-item">
                            <div class="history-header">
                                <div>
                                    <h6 class="history-title">${item.title}</h6>
                                    <div class="history-date">${item.created_date}</div>
                                </div>
                            </div>
                            <div class="history-files">
                                ${filesHTML}
                            </div>
                        </div>
                    `;
                }).join('');

                historyContent.innerHTML = historyHTML;

            } catch (error) {
                console.error('åŠ è½½å†å²è®°å½•å¤±è´¥:', error);
                historyContent.innerHTML = `
                    <div class="empty-history">
                        <i class="bi bi-exclamation-triangle"></i>
                        <h5>åŠ è½½å¤±è´¥</h5>
                        <p>${error.message}</p>
                        <button class="btn btn-secondary mt-3" onclick="loadHistory()">
                            <i class="bi bi-arrow-clockwise"></i>
                            é‡è¯•
                        </button>
                    </div>
                `;
            }
        }

        // æŸ¥çœ‹å†å²æ–‡ä»¶
        async function viewHistoryFile(filename, fileType) {
            try {
                const response = await fetch(`/api/history/${filename}`);
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'è·å–æ–‡ä»¶å¤±è´¥');
                }

                // æ˜¾ç¤ºæ–‡ä»¶å†…å®¹
                const content = result.content;
                
                // æ ¹æ®æ–‡ä»¶ç±»å‹åˆ‡æ¢åˆ°å¯¹åº”æ ‡ç­¾é¡µ
                if (fileType === 'mindnote') {
                    document.getElementById('mindnote-tab').click();
                    document.getElementById('mindnoteContent').textContent = content;
                } else {
                    document.getElementById('raw-tab').click();
                    document.getElementById('rawContent').textContent = content;
                }

                // æ˜¾ç¤ºæˆåŠŸæç¤º
                showAlert(`å·²åŠ è½½å†å²æ–‡ä»¶: ${filename}`, 'success');

            } catch (error) {
                console.error('æŸ¥çœ‹å†å²æ–‡ä»¶å¤±è´¥:', error);
                showAlert(`æŸ¥çœ‹æ–‡ä»¶å¤±è´¥: ${error.message}`, 'danger');
            }
        }

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        // æ‰“å¼€å†å²ç®¡ç†æ¨¡æ€æ¡†
        function openHistoryManager() {
            const modal = document.getElementById('historyManagerModal');
            modal.style.display = 'flex';
            loadHistoryForManager();
        }

        // å…³é—­å†å²ç®¡ç†æ¨¡æ€æ¡†
        function closeHistoryManager() {
            const modal = document.getElementById('historyManagerModal');
            modal.style.display = 'none';
        }

        // ä¸ºå†å²ç®¡ç†å™¨åŠ è½½æ•°æ®
        async function loadHistoryForManager() {
            const historyContent = document.getElementById('historyManagerContent');
            
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                historyContent.innerHTML = `
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">åŠ è½½ä¸­...</span>
                        </div>
                        <p class="mt-3">æ­£åœ¨åŠ è½½å†å²è®°å½•...</p>
                    </div>
                `;

                const response = await fetch('/api/history');
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'åŠ è½½å¤±è´¥');
                }

                // æ›´æ–°ä¸»é¡µé¢çš„å†å²ç»Ÿè®¡
                updateHistoryStats(result.history);

                if (result.history.length === 0) {
                    historyContent.innerHTML = `
                        <div class="empty-history">
                            <i class="bi bi-clock-history"></i>
                            <h5>æš‚æ— å†å²è®°å½•</h5>
                            <p>ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹åï¼Œå†å²è®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                        </div>
                    `;
                    return;
                }

                // æ¸²æŸ“å†å²è®°å½•ï¼ˆå¢å¼ºç‰ˆï¼‰
                const historyHTML = result.history.map(item => {
                    const filesHTML = item.files.map(file => {
                        const fileTypeText = {
                            'raw': 'åŸå§‹æ ¼å¼',
                            'mindnote': 'æ€ç»´ç¬”è®°',
                            'final': 'æœ€ç»ˆæ ¼å¼'
                        }[file.file_type] || 'æœªçŸ¥æ ¼å¼';
                        
                        const fileSize = formatFileSize(file.size);
                        
                        return `
                            <div class="file-badge-container">
                                <div class="file-badge-info">
                                    <i class="bi bi-file-text"></i>
                                    <span class="file-type">${fileTypeText}</span>
                                    <span class="file-size">${fileSize}</span>
                                </div>
                                <div class="file-badge-actions">
                                    <button class="btn btn-sm btn-outline-primary" onclick="viewHistoryFileInManager('${file.filename}', '${file.file_type}')" title="æŸ¥çœ‹">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-success" onclick="copyHistoryFile('${file.filename}', '${file.file_type}')" title="å¤åˆ¶">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="downloadHistoryFile('${file.filename}')" title="ä¸‹è½½">
                                        <i class="bi bi-download"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('');

                    return `
                        <div class="history-item">
                            <div class="history-header">
                                <div>
                                    <h6 class="history-title">${item.title}</h6>
                                    <div class="history-date">${item.created_date}</div>
                                </div>
                            </div>
                            <div class="history-files">
                                ${filesHTML}
                            </div>
                        </div>
                    `;
                }).join('');

                historyContent.innerHTML = historyHTML;

            } catch (error) {
                console.error('åŠ è½½å†å²è®°å½•å¤±è´¥:', error);
                historyContent.innerHTML = `
                    <div class="empty-history">
                        <i class="bi bi-exclamation-triangle"></i>
                        <h5>åŠ è½½å¤±è´¥</h5>
                        <p>${error.message}</p>
                        <button class="btn btn-secondary mt-3" onclick="loadHistoryForManager()">
                            <i class="bi bi-arrow-clockwise"></i>
                            é‡è¯•
                        </button>
                    </div>
                `;
            }
        }

        // æ›´æ–°å†å²ç»Ÿè®¡
        function updateHistoryStats(history) {
            const historyCount = document.getElementById('historyCount');
            historyCount.textContent = history.length;
        }

        // åœ¨å†å²ç®¡ç†å™¨ä¸­æŸ¥çœ‹æ–‡ä»¶
        async function viewHistoryFileInManager(filename, fileType) {
            try {
                const response = await fetch(`/api/history/${filename}`);
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'è·å–æ–‡ä»¶å¤±è´¥');
                }

                // æ˜¾ç¤ºæ–‡ä»¶å†…å®¹é¢„è§ˆ
                showFilePreview(result.content, filename, fileType);

            } catch (error) {
                console.error('æŸ¥çœ‹å†å²æ–‡ä»¶å¤±è´¥:', error);
                showAlert(`æŸ¥çœ‹æ–‡ä»¶å¤±è´¥: ${error.message}`, 'danger');
            }
        }

        // å¤åˆ¶å†å²æ–‡ä»¶
        async function copyHistoryFile(filename, fileType) {
            try {
                const response = await fetch(`/api/history/${filename}`);
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'è·å–æ–‡ä»¶å¤±è´¥');
                }

                const content = result.content;
                
                // ä½¿ç”¨ç°ä»£Clipboard API
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(content);
                } else {
                    // é™çº§æ–¹æ¡ˆ
                    const textArea = document.createElement('textarea');
                    textArea.value = content;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                }
                
                showCopyFeedback('âœ… å†å²æ–‡ä»¶å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');

            } catch (error) {
                console.error('å¤åˆ¶å†å²æ–‡ä»¶å¤±è´¥:', error);
                showAlert(`å¤åˆ¶å¤±è´¥: ${error.message}`, 'danger');
            }
        }

        // ä¸‹è½½å†å²æ–‡ä»¶
        function downloadHistoryFile(filename) {
            const url = `/api/download/raw/${filename}`;
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // æ˜¾ç¤ºæ–‡ä»¶é¢„è§ˆ
        function showFilePreview(content, filename, fileType) {
            const fileTypeText = {
                'raw': 'åŸå§‹æ ¼å¼',
                'mindnote': 'æ€ç»´ç¬”è®°æ ¼å¼',
                'final': 'æœ€ç»ˆæ ¼å¼'
            }[fileType] || 'æœªçŸ¥æ ¼å¼';

            // åˆ›å»ºé¢„è§ˆæ¨¡æ€æ¡†
            const previewHTML = `
                <div class="history-manager-modal" id="filePreviewModal">
                    <div class="history-manager-content" style="width: 90%; max-width: 1000px;">
                        <div class="history-manager-header">
                            <h5 class="history-manager-title">
                                <i class="bi bi-file-text"></i>
                                ${filename} (${fileTypeText})
                            </h5>
                            <button class="history-manager-close" onclick="closeFilePreview()">
                                <i class="bi bi-x"></i>
                            </button>
                        </div>
                        <div class="history-manager-body">
                            <div class="preview-content" style="max-height: 50vh; overflow-y: auto;">
                                ${content.replace(/\n/g, '<br>').replace(/\t/g, '&nbsp;&nbsp;&nbsp;&nbsp;')}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // ç§»é™¤ç°æœ‰é¢„è§ˆ
            const existingPreview = document.getElementById('filePreviewModal');
            if (existingPreview) {
                existingPreview.remove();
            }

            // æ·»åŠ æ–°é¢„è§ˆ
            document.body.insertAdjacentHTML('beforeend', previewHTML);
            document.getElementById('filePreviewModal').style.display = 'flex';
        }

        // å…³é—­æ–‡ä»¶é¢„è§ˆ
        function closeFilePreview() {
            const modal = document.getElementById('filePreviewModal');
            if (modal) {
                modal.remove();
            }
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('historyManagerModal');
            if (event.target === modal) {
                closeHistoryManager();
            }
            
            const promptModal = document.getElementById('promptManagerModal');
            if (event.target === promptModal) {
                closePromptManager();
            }
            
            const previewModal = document.getElementById('filePreviewModal');
            if (event.target === previewModal) {
                closeFilePreview();
            }
            
            const promptPreviewModal = document.getElementById('promptPreviewModal');
            if (event.target === promptPreviewModal) {
                closePromptPreview();
            }
        });

        // ==================== æç¤ºè¯ç®¡ç†åŠŸèƒ½ ====================

        // æ‰“å¼€æç¤ºè¯ç®¡ç†æ¨¡æ€æ¡†
        function openPromptManager() {
            const modal = document.getElementById('promptManagerModal');
            modal.style.display = 'flex';
            loadPromptsForManager();
        }

        // å…³é—­æç¤ºè¯ç®¡ç†æ¨¡æ€æ¡†
        function closePromptManager() {
            const modal = document.getElementById('promptManagerModal');
            modal.style.display = 'none';
        }

        // åŠ è½½æç¤ºè¯åˆ—è¡¨
        async function loadPrompts() {
            try {
                const response = await fetch('/api/prompts');
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'åŠ è½½å¤±è´¥');
                }

                // æ›´æ–°æç¤ºè¯ç»Ÿè®¡
                updatePromptStats(result.prompts);

            } catch (error) {
                console.error('åŠ è½½æç¤ºè¯å¤±è´¥:', error);
                showAlert(`åŠ è½½æç¤ºè¯å¤±è´¥: ${error.message}`, 'danger');
            }
        }

        // ä¸ºæç¤ºè¯ç®¡ç†å™¨åŠ è½½æ•°æ®
        async function loadPromptsForManager() {
            const promptContent = document.getElementById('promptManagerContent');
            
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                promptContent.innerHTML = `
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">åŠ è½½ä¸­...</span>
                        </div>
                        <p class="mt-3">æ­£åœ¨åŠ è½½æç¤ºè¯...</p>
                    </div>
                `;

                const response = await fetch('/api/prompts');
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'åŠ è½½å¤±è´¥');
                }

                // æ›´æ–°ä¸»é¡µé¢çš„æç¤ºè¯ç»Ÿè®¡
                updatePromptStats(result.prompts);

                if (result.prompts.length === 0) {
                    promptContent.innerHTML = `
                        <div class="empty-history">
                            <i class="bi bi-chat-quote"></i>
                            <h5>æš‚æ— æç¤ºè¯</h5>
                            <p>æç¤ºè¯æ–‡ä»¶å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                        </div>
                    `;
                    return;
                }

                // æ¸²æŸ“æç¤ºè¯åˆ—è¡¨
                const promptsHTML = result.prompts.map(prompt => {
                    const fileSize = formatFileSize(prompt.size);
                    const isDefault = ['mtp_optimized_prompt.txt', 'mtp_optimized_prompt_v1.txt', 'mtp_optimized_prompt_full.txt'].includes(prompt.filename);
                    
                    return `
                        <div class="history-item">
                            <div class="history-header">
                                <div>
                                    <h6 class="history-title">
                                        ${prompt.name}
                                        ${isDefault ? '<span class="badge bg-primary ms-2">é»˜è®¤</span>' : ''}
                                    </h6>
                                    <div class="history-date">${prompt.modified_date} | ${fileSize}</div>
                                </div>
                            </div>
                            <div class="history-files">
                                <div class="file-badge-container">
                                    <div class="file-badge-info">
                                        <i class="bi bi-file-text"></i>
                                        <span class="file-type">æç¤ºè¯æ¨¡æ¿</span>
                                        <span class="file-size">${fileSize}</span>
                                    </div>
                                    <div class="file-badge-actions">
                                        <button class="btn btn-sm btn-outline-primary" onclick="viewPrompt('${prompt.filename}')" title="æŸ¥çœ‹">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-success" onclick="copyPrompt('${prompt.filename}')" title="å¤åˆ¶">
                                            <i class="bi bi-clipboard"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary" onclick="downloadPrompt('${prompt.filename}')" title="ä¸‹è½½">
                                            <i class="bi bi-download"></i>
                                        </button>
                                        ${!isDefault ? `<button class="btn btn-sm btn-outline-danger" onclick="deletePrompt('${prompt.filename}')" title="åˆ é™¤">
                                            <i class="bi bi-trash"></i>
                                        </button>` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                promptContent.innerHTML = promptsHTML;

            } catch (error) {
                console.error('åŠ è½½æç¤ºè¯å¤±è´¥:', error);
                promptContent.innerHTML = `
                    <div class="empty-history">
                        <i class="bi bi-exclamation-triangle"></i>
                        <h5>åŠ è½½å¤±è´¥</h5>
                        <p>${error.message}</p>
                        <button class="btn btn-secondary mt-3" onclick="loadPromptsForManager()">
                            <i class="bi bi-arrow-clockwise"></i>
                            é‡è¯•
                        </button>
                    </div>
                `;
            }
        }

        // æ›´æ–°æç¤ºè¯ç»Ÿè®¡
        function updatePromptStats(prompts) {
            const promptCount = document.getElementById('promptCount');
            promptCount.textContent = prompts.length;
        }

        // æŸ¥çœ‹æç¤ºè¯
        async function viewPrompt(filename) {
            try {
                const response = await fetch(`/api/prompts/${filename}`);
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'è·å–æç¤ºè¯å¤±è´¥');
                }

                // æ˜¾ç¤ºæç¤ºè¯å†…å®¹é¢„è§ˆ
                showPromptPreview(result.content, filename, result.name);

            } catch (error) {
                console.error('æŸ¥çœ‹æç¤ºè¯å¤±è´¥:', error);
                showAlert(`æŸ¥çœ‹æç¤ºè¯å¤±è´¥: ${error.message}`, 'danger');
            }
        }

        // å¤åˆ¶æç¤ºè¯
        async function copyPrompt(filename) {
            try {
                const response = await fetch(`/api/prompts/${filename}`);
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'è·å–æç¤ºè¯å¤±è´¥');
                }

                const content = result.content;
                
                // ä½¿ç”¨ç°ä»£Clipboard API
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(content);
                } else {
                    // é™çº§æ–¹æ¡ˆ
                    const textArea = document.createElement('textarea');
                    textArea.value = content;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                }
                
                showCopyFeedback('âœ… æç¤ºè¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');

            } catch (error) {
                console.error('å¤åˆ¶æç¤ºè¯å¤±è´¥:', error);
                showAlert(`å¤åˆ¶å¤±è´¥: ${error.message}`, 'danger');
            }
        }

        // ä¸‹è½½æç¤ºè¯
        function downloadPrompt(filename) {
            const url = `/api/prompts/${filename}/download`;
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // åˆ é™¤æç¤ºè¯
        async function deletePrompt(filename) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤æç¤ºè¯æ–‡ä»¶ "${filename}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`)) {
                return;
            }

            try {
                const response = await fetch(`/api/prompts/${filename}`, {
                    method: 'DELETE'
                });
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'åˆ é™¤å¤±è´¥');
                }

                showAlert(result.message, 'success');
                
                // é‡æ–°åŠ è½½æç¤ºè¯åˆ—è¡¨
                loadPromptsForManager();

            } catch (error) {
                console.error('åˆ é™¤æç¤ºè¯å¤±è´¥:', error);
                showAlert(`åˆ é™¤å¤±è´¥: ${error.message}`, 'danger');
            }
        }

        // æ˜¾ç¤ºæç¤ºè¯é¢„è§ˆ
        function showPromptPreview(content, filename, name) {
            // åˆ›å»ºé¢„è§ˆæ¨¡æ€æ¡†
            const previewHTML = `
                <div class="history-manager-modal" id="promptPreviewModal">
                    <div class="history-manager-content" style="width: 90%; max-width: 1000px;">
                        <div class="history-manager-header">
                            <h5 class="history-manager-title">
                                <i class="bi bi-chat-quote"></i>
                                ${name} (${filename})
                            </h5>
                            <button class="history-manager-close" onclick="closePromptPreview()">
                                <i class="bi bi-x"></i>
                            </button>
                        </div>
                        <div class="history-manager-body">
                            <div class="preview-content" style="max-height: 50vh; overflow-y: auto; font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;">
                                ${content.replace(/\n/g, '<br>').replace(/\t/g, '&nbsp;&nbsp;&nbsp;&nbsp;')}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // ç§»é™¤ç°æœ‰é¢„è§ˆ
            const existingPreview = document.getElementById('promptPreviewModal');
            if (existingPreview) {
                existingPreview.remove();
            }

            // æ·»åŠ æ–°é¢„è§ˆ
            document.body.insertAdjacentHTML('beforeend', previewHTML);
            document.getElementById('promptPreviewModal').style.display = 'flex';
        }

        // å…³é—­æç¤ºè¯é¢„è§ˆ
        function closePromptPreview() {
            const modal = document.getElementById('promptPreviewModal');
            if (modal) {
                modal.remove();
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–å†å²ç»Ÿè®¡
        document.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½å†å²ç»Ÿè®¡
            loadHistoryForManager();
            // åŠ è½½æç¤ºè¯ç»Ÿè®¡
            loadPromptsForManager();
        });

        // å›¾ç‰‡æŸ¥çœ‹åŠŸèƒ½
        function openImageModal(imageSrc, imageAlt) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalLabel = document.getElementById('imageModalLabel');
            
            modalImage.src = imageSrc;
            modalImage.alt = imageAlt;
            modalLabel.textContent = imageAlt;
            
            const bootstrapModal = new bootstrap.Modal(modal);
            bootstrapModal.show();
        }

        // æç¤ºè¯æ¨¡æ¿å˜æ›´å¤„ç†
        function onPromptTemplateChange() {
            const templateSelect = document.getElementById('promptTemplate');
            const customRequirementsSection = document.getElementById('customRequirementsSection');
            const selectedTemplate = templateSelect.value;
            
            if (selectedTemplate) {
                // æ£€æŸ¥æ˜¯å¦ä¸ºæ–°å¢æ¨¡æ¿
                if (selectedTemplate === 'new_template') {
                    // æ–°å¢æ¨¡æ¿ï¼šéšè—è‡ªå®šä¹‰è¦æ±‚ï¼Œç›´æ¥æ˜¾ç¤ºåˆ›å»ºæ¨¡æ¿æ¨¡æ€æ¡†
                    customRequirementsSection.style.display = 'none';
                    showCreateTemplateModal();
                    // é‡ç½®é€‰æ‹©
                    templateSelect.value = '';
                } else {
                    // æ ‡å‡†æ¨¡æ¿ï¼šæ˜¾ç¤ºè‡ªå®šä¹‰è¦æ±‚
                    customRequirementsSection.style.display = 'block';
                }
            } else {
                // æ— é€‰æ‹©ï¼šéšè—è‡ªå®šä¹‰è¦æ±‚
                customRequirementsSection.style.display = 'none';
            }
        }

        // é¢„è§ˆæç¤ºè¯æ¨¡æ¿å†…å®¹
        async function previewPromptTemplate() {
            const promptTemplate = document.getElementById('promptTemplate').value;
            
            if (!promptTemplate) {
                showAlert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæç¤ºè¯æ¨¡æ¿', 'warning');
                return;
            }
            
            try {
                const response = await fetch(`/api/prompt-templates/${promptTemplate}/content`);
                const result = await response.json();
                
                if (result.success) {
                    // æ˜¾ç¤ºé¢„è§ˆæ¨¡æ€æ¡†
                    showPromptPreview(result.content, promptTemplate, result.name || 'æ¨¡æ¿é¢„è§ˆ');
                } else {
                    showAlert(`è·å–æ¨¡æ¿å†…å®¹å¤±è´¥: ${result.error}`, 'danger');
                }
            } catch (error) {
                showAlert(`è¯·æ±‚å¤±è´¥: ${error.message}`, 'danger');
            }
        }

        // æ˜¾ç¤ºåˆ›å»ºè‡ªå®šä¹‰æç¤ºè¯æ¨¡æ¿æ¨¡æ€æ¡†
        function showCreateTemplateModal() {
            const modal = document.getElementById('createTemplateModal');
            const bootstrapModal = new bootstrap.Modal(modal);
            bootstrapModal.show();
        }

        // åˆ›å»ºè‡ªå®šä¹‰æç¤ºè¯æ¨¡æ¿
        async function createCustomTemplate() {
            const templateName = document.getElementById('templateName').value.trim();
            const templateDescription = document.getElementById('templateDescription').value.trim();
            const templateContent = document.getElementById('templateContent').value.trim();
            
            if (!templateName) {
                alert('è¯·è¾“å…¥æ¨¡æ¿åç§°');
                return;
            }
            
            if (!templateContent) {
                alert('è¯·è¾“å…¥æ¨¡æ¿å†…å®¹');
                return;
            }
            
            try {
                const response = await fetch('/api/prompt-templates', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: templateName,
                        description: templateDescription,
                        content: templateContent,
                        supports_custom_requirements: true
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('æ¨¡æ¿åˆ›å»ºæˆåŠŸï¼');
                    // å…³é—­æ¨¡æ€æ¡†
                    const modal = bootstrap.Modal.getInstance(document.getElementById('createTemplateModal'));
                    modal.hide();
                    
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('templateName').value = '';
                    document.getElementById('templateDescription').value = '';
                    document.getElementById('templateContent').value = '';
                    
                    // é‡æ–°åŠ è½½æ¨¡æ¿åˆ—è¡¨
                    await loadPromptTemplates();
                } else {
                    alert('åˆ›å»ºå¤±è´¥ï¼š' + result.error);
                }
            } catch (error) {
                console.error('åˆ›å»ºæ¨¡æ¿å¤±è´¥:', error);
                alert('åˆ›å»ºå¤±è´¥ï¼š' + error.message);
            }
        }

        // å…³é—­å‰ç½®æ¡ä»¶æ¨¡æ€æ¡†
        function closePrerequisites() {
            const modal = document.getElementById('prerequisitesModal');
            modal.style.display = 'none';
        }

        // æ˜¾ç¤ºå‰ç½®æ¡ä»¶æ¨¡æ€æ¡†
        function showPrerequisites() {
            const modal = document.getElementById('prerequisitesModal');
            modal.style.display = 'flex';
        }

        // æ˜¾ç¤ºæ¨¡æ¿ç¼–å†™å¸®åŠ©
        function showTemplateHelp() {
            // è¿™é‡Œå¯ä»¥æ˜¾ç¤ºæ›´è¯¦ç»†çš„å¸®åŠ©ä¿¡æ¯
            alert('æ¨¡æ¿ç¼–å†™å¸®åŠ©ï¼š\n\n1. ä½¿ç”¨ {content} å ä½ç¬¦æ’å…¥éœ€æ±‚æ–‡æ¡£å†…å®¹\n2. ä½¿ç”¨ {user_requirements} å ä½ç¬¦æ’å…¥ç”¨æˆ·è‡ªå®šä¹‰è¦æ±‚\n3. æ¨¡æ¿å†…å®¹åº”è¯¥åŒ…å«å®Œæ•´çš„AIæŒ‡ä»¤å’Œè¾“å‡ºæ ¼å¼è¦æ±‚\n4. å»ºè®®å‚è€ƒç°æœ‰æ¨¡æ¿çš„æ ¼å¼å’Œç»“æ„');
        }
    </script>

    <!-- å›¾ç‰‡æŸ¥çœ‹æ¨¡æ€å¼¹çª— -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="imageModalLabel">å›¾ç‰‡æŸ¥çœ‹</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="modalImage" src="" alt="å¤§å›¾æŸ¥çœ‹" class="img-fluid">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                </div>
            </div>
        </div>
    </div>

    <!-- åˆ›å»ºè‡ªå®šä¹‰æç¤ºè¯æ¨¡æ¿æ¨¡æ€æ¡† -->
    <div class="modal fade" id="createTemplateModal" tabindex="-1" aria-labelledby="createTemplateModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createTemplateModalLabel">
                        <i class="bi bi-plus-circle"></i>
                        åˆ›å»ºè‡ªå®šä¹‰æç¤ºè¯æ¨¡æ¿
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label for="templateName" class="form-label">æ¨¡æ¿åç§°</label>
                                <input type="text" class="form-control" id="templateName" placeholder="è¯·è¾“å…¥æ¨¡æ¿åç§°">
                            </div>
                            
                            <div class="mb-3">
                                <label for="templateDescription" class="form-label">æ¨¡æ¿æè¿°</label>
                                <textarea class="form-control" id="templateDescription" rows="2" placeholder="è¯·è¾“å…¥æ¨¡æ¿æè¿°"></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="templateContent" class="form-label">
                                    æ¨¡æ¿å†…å®¹
                                    <button type="button" class="btn btn-sm btn-outline-info ms-2" onclick="showTemplateHelp()" title="æŸ¥çœ‹æ¨¡æ¿ç¼–å†™å¸®åŠ©">
                                        <i class="bi bi-question-circle"></i>
                                    </button>
                                </label>
                                <textarea class="form-control" id="templateContent" rows="12" 
                                          placeholder="è¯·è¾“å…¥æ¨¡æ¿å†…å®¹ï¼Œæ”¯æŒä½¿ç”¨ {content} å’Œ {user_requirements} å ä½ç¬¦"></textarea>
                                <small class="form-text text-muted">
                                    æ”¯æŒå ä½ç¬¦ï¼š{content} è¡¨ç¤ºéœ€æ±‚æ–‡æ¡£å†…å®¹ï¼Œ{user_requirements} è¡¨ç¤ºç”¨æˆ·è‡ªå®šä¹‰è¦æ±‚
                                </small>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="template-help-panel">
                                <h6><i class="bi bi-lightbulb"></i> æ¨¡æ¿ç¼–å†™æç¤º</h6>
                                <ul class="template-tips">
                                    <li>ä½¿ç”¨ {content} å ä½ç¬¦æ’å…¥éœ€æ±‚æ–‡æ¡£å†…å®¹</li>
                                    <li>ä½¿ç”¨ {user_requirements} å ä½ç¬¦æ’å…¥ç”¨æˆ·è‡ªå®šä¹‰è¦æ±‚</li>
                                    <li>æ¨¡æ¿å†…å®¹åº”è¯¥åŒ…å«å®Œæ•´çš„AIæŒ‡ä»¤å’Œè¾“å‡ºæ ¼å¼è¦æ±‚</li>
                                    <li>å»ºè®®å‚è€ƒç°æœ‰æ¨¡æ¿çš„æ ¼å¼å’Œç»“æ„</li>
                                </ul>
                                
                                <div class="template-example">
                                    <h6>æ ‡å‡†æ¨¡æ¿ç¤ºä¾‹ï¼š</h6>
                                    <div class="example-content">
                                        <code>
ä½ æ˜¯ä¸€åèµ„æ·±QAï¼Œè¯·åŸºäºä»¥ä¸‹éœ€æ±‚æ–‡æ¡£ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼š<br><br>
éœ€æ±‚æ–‡æ¡£å†…å®¹ï¼š<br>
{content}<br><br>
ç”¨æˆ·è‡ªå®šä¹‰è¦æ±‚ï¼š<br>
{user_requirements}<br><br>
è¯·è¾“å‡ºç»“æ„åŒ–æµ‹è¯•ç”¨ä¾‹...
                                        </code>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-primary" onclick="createCustomTemplate()">åˆ›å»ºæ¨¡æ¿</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html> 